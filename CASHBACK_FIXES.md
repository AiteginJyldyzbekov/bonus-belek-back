# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ –∫–µ—à–±–µ–∫–∞

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –û—à–∏–±–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** `productPrice` –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞, –∞ Prisma –æ–∂–∏–¥–∞–ª —á–∏—Å–ª–æ
**–†–µ—à–µ–Ω–∏–µ:** 
- –ò–∑–º–µ–Ω–∏–ª–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ `UserService.addCashback()` —á—Ç–æ–±—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å `productPrice: number`
- –£–±—Ä–∞–ª–∏ –ª–∏—à–Ω–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤

### 2. –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫–µ—à–±–µ–∫–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–µ—à–±–µ–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª—Å—è —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä: 0.9299999999999999)
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏–ª–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 1 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π

```typescript
// –ë—ã–ª–æ:
const cashbackAmount = product.price * this.CASHBACK_PERCENTAGE;

// –°—Ç–∞–ª–æ:
const cashbackAmount = Math.round((product.price * this.CASHBACK_PERCENTAGE) * 10) / 10;
```

### 3. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ AdminGuard
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –±—ã–ª–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
**–†–µ—à–µ–Ω–∏–µ:** –í—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∏ `@UseGuards(AdminGuard)` –≤–æ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö –∫–µ—à–±–µ–∫–∞

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MockAPI
**–ü—Ä–æ–±–ª–µ–º–∞:** Supabase –Ω–µ –æ–ø–ª–∞—á–µ–Ω
**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ MockAPI —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ª–µ–≥–∫–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ Supabase

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á–µ—Ç–æ–≤ –∫–µ—à–±–µ–∫–∞

| –¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ | 3% –∫–µ—à–±–µ–∫–∞ | –û–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–π –∫–µ—à–±–µ–∫ (–¥–æ 1 –∑–Ω–∞–∫–∞) |
|-------------|------------|--------------------------------|
| 31.00       | 0.93       | 0.9                            |
| 50.00       | 1.50       | 1.5                            |
| 100.00      | 3.00       | 3.0                            |
| 150.00      | 4.50       | 4.5                            |
| 80.00       | 2.40       | 2.4                            |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è:
```bash
curl -X POST http://localhost:8080/cashback/process \
  -H "Content-Type: application/json" \
  -d '{"productId": "1", "phoneNumber": "+996701234567"}'
```

### –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "statusCode": 200,
  "message": "Cashback processed successfully",
  "data": {
    "cashback": {
      "amount": 0.9,  // –û–∫—Ä—É–≥–ª–µ–Ω–æ –¥–æ 1 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
      "percentage": 3
    }
  }
}
```

## üîÑ –í–∫–ª—é—á–µ–Ω–∏–µ AdminGuard –æ–±—Ä–∞—Ç–Ω–æ

–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:

1. **–í `src/cashback/cashback.controller.ts`:**
   ```typescript
   @Post('products')
   @UseGuards(AdminGuard) // –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å
   async getProducts(@Body() body: GetProductsDto) {
   ```

2. **–í `src/cashback/dto/cashback.dto.ts`:**
   ```typescript
   export class GetProductsDto {
     @IsString()
     @IsNotEmpty() // –£–±—Ä–∞—Ç—å @IsOptional()
     @Matches(/^\+?[1-9]\d{1,14}$/, {
       message: 'Phone number must be in valid format (e.g., +996701234567)'
     })
     phoneNumber: string; // –£–±—Ä–∞—Ç—å ?
   }
   ```

## ‚úÖ –°—Ç–∞—Ç—É—Å

- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –∫–µ—à–±–µ–∫–∞
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å MockAPI
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
