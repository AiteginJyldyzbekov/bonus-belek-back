# –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ AdminGuard

## üîÑ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- AdminGuard –ø–æ–ª—É—á–∞–ª `phoneNumber` –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-User-Phone`
- –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ GET –∑–∞–ø—Ä–æ—Å—ã
- –¢—Ä–µ–±–æ–≤–∞–ª—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- AdminGuard –ø–æ–ª—É—á–∞–µ—Ç `phoneNumber` –∏–∑ —Ç–µ–ª–∞ POST –∑–∞–ø—Ä–æ—Å–∞
- –í—Å–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç POST –∑–∞–ø—Ä–æ—Å—ã
- `phoneNumber` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ JSON —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞

## üìù –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
**–ë—ã–ª–æ:**
```bash
GET /cashback/products
Headers: X-User-Phone: +996701234567
```

**–°—Ç–∞–ª–æ:**
```bash
POST /cashback/products
Content-Type: application/json
Body: {"phoneNumber": "+996701234567"}
```

### 2. –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
**–ë—ã–ª–æ:**
```bash
GET /cashback/products/search?query=iPhone
Headers: X-User-Phone: +996701234567
```

**–°—Ç–∞–ª–æ:**
```bash
POST /cashback/products/search
Content-Type: application/json
Body: {
  "query": "iPhone",
  "phoneNumber": "+996701234567"
}
```

### 3. –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∫–µ—à–±–µ–∫–∞
**–ë—ã–ª–æ:**
```bash
POST /cashback/process
Headers: X-User-Phone: +996701234567
Body: {"productId": "uuid", "phoneNumber": "+996701234567"}
```

**–°—Ç–∞–ª–æ:**
```bash
POST /cashback/process
Content-Type: application/json
Body: {"productId": "uuid", "phoneNumber": "+996701234567"}
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. **`src/guards/admin.guard.ts`**
   - –ò–∑–º–µ–Ω–µ–Ω —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è `phoneNumber`: `request.body?.phoneNumber`
   - –û–±–Ω–æ–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

2. **`src/cashback/dto/cashback.dto.ts`**
   - –î–æ–±–∞–≤–ª–µ–Ω `GetProductsDto` —Å –ø–æ–ª–µ–º `phoneNumber`
   - –û–±–Ω–æ–≤–ª–µ–Ω `SearchProductsDto` —Å –ø–æ–ª–µ–º `phoneNumber`

3. **`src/cashback/cashback.controller.ts`**
   - –ò–∑–º–µ–Ω–µ–Ω—ã –º–µ—Ç–æ–¥—ã —Å GET –Ω–∞ POST
   - –î–æ–±–∞–≤–ª–µ–Ω—ã DTO –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

1. **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ** - –≤—Å–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç POST
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞, –∞ –Ω–µ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ø–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ DTO
4. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –Ω–µ –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –ø—Ä–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:
```bash
powershell -ExecutionPolicy Bypass -File test_admin_guard.ps1
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- ‚úÖ –£—Å–ø–µ—à–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º
- ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∫—É —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º
- ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∫—É –±–µ–∑ phoneNumber –≤ —Ç–µ–ª–µ
- ‚úÖ –†–∞–±–æ—Ç—É –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï:** –≠—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Ä—É—à–∞—é—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å!

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç–∞—Ä—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –∏—Ö –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å:

1. –ò–∑–º–µ–Ω–∏—Ç—å GET –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ POST
2. –£–±—Ä–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-User-Phone`
3. –î–æ–±–∞–≤–∏—Ç—å `phoneNumber` –≤ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
4. –î–æ–±–∞–≤–∏—Ç—å `Content-Type: application/json`

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤

- [ ] –ò–∑–º–µ–Ω–∏—Ç—å GET `/cashback/products` –Ω–∞ POST
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å GET `/cashback/products/search` –Ω–∞ POST
- [ ] –£–±—Ä–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-User-Phone`
- [ ] –î–æ–±–∞–≤–∏—Ç—å `phoneNumber` –≤ JSON —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å `Content-Type: application/json`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (–Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
